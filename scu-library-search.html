<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>川大图书馆搜索 - 快速检索</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #8c1d1d 0%, #a52a2a 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .header-icon {
            width: 30px;
            height: 30px;
            background: #8c1d1d;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .content {
            padding: 30px 20px;
        }

        .search-section {
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 15px;
            border: none;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            outline: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            box-shadow: 0 4px 20px rgba(140, 29, 29, 0.3);
        }

        .search-button {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background: #8c1d1d;
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(140, 29, 29, 0.3);
        }

        .search-button:hover {
            background: #a52a2a;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(140, 29, 29, 0.4);
        }

        .search-button:active {
            transform: translateY(0);
        }

        .search-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .history-section {
            margin-top: 30px;
        }

        .history-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            color: white;
        }

        .history-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: bold;
            opacity: 0.8;
        }

        .clear-button {
            background: none;
            border: none;
            color: white;
            opacity: 0.7;
            cursor: pointer;
            font-size: 12px;
            transition: opacity 0.3s ease;
        }

        .clear-button:hover {
            opacity: 1;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(4px);
        }

        .history-text {
            color: white;
            font-size: 14px;
            flex: 1;
            margin-right: 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .history-remove {
            background: none;
            border: none;
            color: white;
            opacity: 0.6;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s ease;
            padding: 4px;
        }

        .history-remove:hover {
            opacity: 1;
            color: #ff6b6b;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: white;
            opacity: 0.6;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .footer {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            opacity: 0.7;
            font-size: 12px;
        }

        /* 滚动条样式 */
        .history-list::-webkit-scrollbar {
            width: 4px;
        }

        .history-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        /* 响应式设计 */
        @media (max-width: 480px) {
            .app-container {
                margin: 10px;
                max-width: none;
            }

            .content {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="header-title">
                <div class="header-icon">
                    <i class="fas fa-book"></i>
                </div>
                川大图书馆搜索
            </div>
            <i class="fas fa-graduation-cap" style="color: white; opacity: 0.8;"></i>
        </div>

        <div class="content">
            <div class="search-section">
                <input
                    type="text"
                    class="search-input"
                    id="bookInput"
                    placeholder="输入书名进行检索..."
                    onkeypress="handleKeyPress(event)"
                >
                <button class="search-button" onclick="handleSearch()">
                    <i class="fas fa-external-link-alt"></i> 立即检索
                </button>
            </div>

            <div class="history-section">
                <div class="history-header">
                    <div class="history-title">
                        <i class="fas fa-history"></i>
                        最近搜索
                    </div>
                    <button class="clear-button" onclick="clearHistory()" style="display: none;" id="clearBtn">
                        <i class="fas fa-trash"></i> 清除
                    </button>
                </div>
                <div class="history-list" id="historyList">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <p>暂无搜索记录</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            Made for Sichuan University Students
        </div>
    </div>

    <script>
        // 配置
        const DEFAULT_BASE_URL = "http://opac.scu.edu.cn:8080/F/9F63EJD6J8RI1731DPHAUF7B5FM4JB151M4D369YC7XFUCITEF-09218?func=find-m&find_code=WRD&request=";
        const LOCAL_STORAGE_KEY = 'scu_library_history';

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
        });

        // 处理搜索
        function handleSearch(bookTitle = null) {
            const title = bookTitle || document.getElementById('bookInput').value.trim();
            if (!title) return;

            const searchUrl = DEFAULT_BASE_URL + encodeURIComponent(title) +
                            "&find_base=CNPUB&find_base=ENPUB&pds_handle=GUEST";

            // 在新窗口打开搜索结果
            window.open(searchUrl, '_blank');

            // 添加到历史记录
            addToHistory(title);

            // 清空输入框
            document.getElementById('bookInput').value = '';
        }

        // 处理回车键
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                handleSearch();
            }
        }

        // 添加到历史记录
        function addToHistory(title) {
            let history = getHistory();

            // 移除已存在的相同记录
            history = history.filter(item => item !== title);

            // 添加到最前面
            history.unshift(title);

            // 保留最近10条
            history = history.slice(0, 10);

            // 保存到本地存储
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(history));

            // 更新显示
            loadHistory();
        }

        // 获取历史记录
        function getHistory() {
            const saved = localStorage.getItem(LOCAL_STORAGE_KEY);
            return saved ? JSON.parse(saved) : [];
        }

        // 加载历史记录
        function loadHistory() {
            const history = getHistory();
            const historyList = document.getElementById('historyList');
            const clearBtn = document.getElementById('clearBtn');

            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <p>暂无搜索记录</p>
                    </div>
                `;
                clearBtn.style.display = 'none';
            } else {
                historyList.innerHTML = history.map((item, index) => `
                    <div class="history-item" onclick="handleSearch('${item.replace(/'/g, "\\'")}')">
                        <div class="history-text">${item}</div>
                        <button class="history-remove" onclick="removeHistoryItem('${item.replace(/'/g, "\\'")}', event)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `).join('');
                clearBtn.style.display = 'block';
            }
        }

        // 移除单个历史记录
        function removeHistoryItem(item, event) {
            event.stopPropagation();

            let history = getHistory();
            history = history.filter(h => h !== item);

            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(history));
            loadHistory();
        }

        // 清空历史记录
        function clearHistory() {
            if (confirm("确定要清空检索历史吗？")) {
                localStorage.removeItem(LOCAL_STORAGE_KEY);
                loadHistory();
            }
        }

        // 防止点击历史记录项时触发移除按钮
        document.addEventListener('click', function(e) {
            if (e.target.closest('.history-remove')) {
                e.stopPropagation();
            }
        });
    </script>
</body>
</html>